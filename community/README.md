# 仿牛客网项目笔记
## 一，开发社区首页
### 1，为DiscussPost表创建实体类
### 2，为DiscussPost表创建查询数据库的方法接口
#### 2.1 自己写分页功能
#### 2.1 使用分页插件`PageHelper`
### 3，把DiscussPost表中的user_id换成user_name
#### 3.1 使用联表查询
#### 3.2 根据DiscussPost中的user_id通过user表的查询方法查询user_name，该方法在后期使用redis效率较高
## 二，开发社区注册功能
### 1，开启邮箱的SMTP服务
### 2，Spring Email
#### 2.1 导入Spring Email 包
#### 2.2 配置相关参数，在配置文件中配置，尽量避免在java程序中配置
#### 2.3 使用`JavaMailSend`发送邮件
##### 2.3.1 创建通用工具包，实现Mail客户端实现类
##### 2.3.2 JavaMailSend只有两个方法，create和send。先创建一个空对象，借助`MimeMessageHelper`配置相关属性，然后调用send方法发送
### 3，点击链接，打开注册页面。
### 4，提交注册数据。
#### 4.1 导入判断常用数据空值情况的包，设置激活邮件的域名，创建一个工具类用来生成uuid和md5加密
#### 4.2 通过表单提交数据
#### 4.3 服务端验证账号是否已经存在，邮箱是否已经注册
#### 4.4 服务端发送校验激活邮件
#### 5，点击邮件中的链接，访问服务端激活邮件
## 三，开发社区登录退出功能
### 1，使用`Kaptcha`插件生成登录验证码
### 2，发送登录请求，跳转至登录页面
### 3，登录
#### 3.1 验证账号，密码，验证码。
#### 3.2 成功时生成登录凭证发送给用户
#### 3.3 失败时跳转回登录页面
### 4，退出
#### 4.1 退出时将凭证修改为失效状态，跳转至网站首页
## 四，显示登录信息
### 1，定义拦截器，实现`HandlerInterceptor`
### 2, 配置拦截器，指定拦截、排除的路径
### 3，拦截器的应用
#### 3.1 在请求开始时查询登录用户
#### 3.2 在本次请求中持有用户数据
#### 3.2.1 一般使用session或者用redis代替，但考虑到线程隔离，使用ThreadLocal存储当前线程的数据
#### 3.3 在模版视图上显示用户数据
#### 3.4 在请求结束时清理用户数据
## 五，账号设置
### 1，上传文件：请求：POST，表单：enctype=“multipart/form-data”，Spring MVC：通过MultipartFile处理上传文件
### 2， 步骤：1，访问账号设置页面。2，上传头像。3，获取头像
## 六，检查登录状态（禁止直接通过路劲访问当前不能访问的页面，比如未登录状态不能访问登录状态下的一些页面）
### 1，使用拦截器
#### 1.1 在方法前标注自定义注解
#### 1.2 拦截所有请求，只处理带有该注解的方法
### 2，常用的元注解：
#### 2.1 @Target, @Retention, @Document, @Inherited
### 3，读取注解
#### 3.1 Method.getDeclaredAnnotations(), Method.getAnnotation(Class<T> annotationClass)
### 4, 步骤
#### 4.1 新建一个注解，并用元注解进行描述
#### 4.2 为需要拦截的方法打上标记
#### 4.3 定义拦截器，拦截对有标记的方法的访问，并判断当前是否已经登录
#### 4.4 在webMVCConfig中注册拦截器
## 六，过滤敏感词
### 1，前缀树（Trie，字典树，查找树）个人感觉更适合英文，可以过滤出每个单词变体的原始体，对于中文类型黄，可以尝试规则引擎
#### 1.1 查找效率高，内存消耗大
#### 1.2 字符串检索，词频统计，字符串排序等
### 2，敏感词过滤器
#### 2.1 定义前缀树
#### 2.2 根据敏感词，初始化前缀树
#### 2.3 编写过滤敏感词的方法
## 七，发布帖子
### 1，使用AJAX实现异步发送
## 八，帖子详情
## 九，事务（由若干个数据库操作序列组成的逻辑执行单元，要么全执行，要么全不执行）
### 1，事务特性
#### 1.1 原子性：事务是不可再分的最小执行体
#### 1.2 一致性：事务执行需要使数据从一个一致性状态，变为另一个一致性状态
#### 1.3 隔离性：各个事务的执行互不干扰，任何事务的内部操作对其他事务都是隔离的
#### 1.4 持久性：事务一旦提交，对数据所做的任何改变都要记录到永久存储器中
### 2，常见的并发异常
#### 2.1 第一类更新丢失：某一个事务回滚导致另一个事务已更新的数据丢失
#### 2.2 第二类更新丢失：某一个事务的提交导致另一个事务更新的数据丢失
#### 2.3 脏读，幻读（查询多行数据），不可重复读（查询一条数据）
### 3，常见隔离级别
#### 3.1 读取未提交的数据
#### 3.2 读取已提交的数据
#### 3.3 可重复读
#### 3.4 串行化
### 4，数据库锁
#### 4.1 悲观锁（数据库）
##### 4.1.1 事务A对某个数据加了共享锁，其他事务只能加共享锁，不能加排他锁
##### 4.1.2 事务A对某个数据加了排他锁，其他事务既不能加共享锁，也不能加排他锁
### 4.2 乐观锁（自定义）
##### 4.2.1 版本号，时间戳，在更新前检查版本号是否发生变化，若变化则取消本次更新，否则就更新数据
### 5，Spring事务管理
#### 5.1 声明式事务
##### 5.1.1 通过XML配置，声明某个方法的事物特征
##### 5.1.2 通过注解声明方法的事务特征
#### 5.2 编程式事务
##### 5.2.1 通过TransactionTemplate管理事务，并通过它执行数据库操作
## 十，显示评论
### 1，显示帖子的回复，以及帖子回复的回复（用了分页插件）
## 十一，私信列表
### 1，私信列表
#### 1.1 查询当前用户的会话列表
#### 1.2 每条会话只显示一条最新的私信
#### 1.3 支持分页显示
### 2，私信详情
#### 2.1 查询某条会话包含的私信
#### 2.2 支持分页显示
## 改进
### 1，对于检查用户的登录状态，目前是使用线程存储，每次发送一个请求都会查询登录凭证是否过期，此时如果用户在进入index页面时，凭证未过期，但是在下一次请求时凭证过期了就会突然跳转至登录界面，影响用户体验
#### 1.1 对于用户第一次请求时凭证尚未过期的User数据应该保存在session中，可以保证一次会话区间内不需要因为凭证突然过期而重新登录
#### 1.2 如果用户关闭浏览器，则一次会话结束，重新打开浏览器也会因为凭证过期而session被销毁重新登录
#### 1.3 如果用户长时间未操作，超过session保存时间，后续请求会产生新的session，此时凭证过期也会重新登录
#### 1.4 对于用线程来拦截验证保存某些信息，可以针对一些不同请求需要不同验证信息的情况。


